# dnsjs

JavaScript 实现的 DNS 客户端和服务端

## OSI 所在层

DNS 属于应用层协议,通常在网络层使用 UDP 协议实现(DNS 协议包超出 512bit 需要截断分包时,可能是为了完整性改用 TCP 实现)

## 格式

### DNS 报文格式，不论是请求报文，还是 DNS 服务器返回的应答报文，都使用统一的格式。

1.  Header 报文头
2.  Question 查询的问题
3.  Answer 应答
4.  Authority 授权应答
5.  Additional 附加信息
  DNS format

  +--+--+--+--+--+--+--+
  |        Header      |
  +--+--+--+--+--+--+--+
  |      Question      |
  +--+--+--+--+--+--+--+
  |      Answer        |
  +--+--+--+--+--+--+--+
  |      Authority     |
  +--+--+--+--+--+--+--+
  |      Additional    |
  +--+--+--+--+--+--+--+

### Header包含 ID/QR/opcode/AA/TC/RD/RA/Z/RCODE/QDCOUNT/ANCOUNT/NSCOUNT/ARCOUNT 部分,每个部分使用 2 进制拼接
  Header format

    0  1  2  3  4  5  6  7  0  1  2  3  4  5  6  7
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |                      ID                       |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |QR|  opcode   |AA|TC|RD|RA|   Z    |   RCODE   |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |                    QDCOUNT                    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |                    ANCOUNT                    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |                    NSCOUNT                    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |                    ARCOUNT                    |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

### Question 需要转换成 10 进制ASCII码
因为域名是可变的,所以需要先将域名(www.baidu.com)以.拆分成www/baidu/com,根据每个部分字母长度拼成以下格式 3www5baidu3com,通过charCodeAt获取对应的ASCII码
  Question format

    0  1  2  3  4  5  6  7  0  1  2  3  4  5  6  7
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |                     ...                       |
  |                    QNAME                      |
  |                     ...                       |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |                    QTYPE                      |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
  |                    QCLASS                     |
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

### 协议的每个部分通过Number.toString(16)转换成 16 进制,最后合并


### 参考
JavaScript中各进制数字表示方法
//二进制0b开头
//八进制0开头
//十六进制0x开头
使用number.toString(2,8,10,16)可以转换进制

[DNS 请求报文详解](https://juejin.cn/post/6844903582441963527)
